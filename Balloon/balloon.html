<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript" src="./../util/popup.js"></script>
  <script type="text/javascript" src="./../util/audio.js"></script>
  <link rel="stylesheet" href="./../util/default.css" type="text/css">
  <link rel="stylesheet" href="./../util/popup.css" type="text/css">
  <script type="text/javascript" src="popup2.js"></script>
  <link rel="stylesheet" href="popup2.css" type="text/css">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Percent Balloon</title>
  <style>
    :root {
      /*色指定*/
      --use-color-a2: rgba(36, 50, 80, 0.9);
      --use-color-c1: rgba(101, 154, 210, 0.7);
    }

    html {
      touch-action: manipulation;
    }

    body {
      background-image: url("img/sky.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      height: 100vh;
      user-select: none;
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 5px;
    }

    .website-box {
      position: relative;
      border: 1px solid #ccc;
      padding: 10px;
      height: 30vh;
      text-align: center;
      background-color: rgba(58, 94, 231, 0.8);
    }

    .website-box2 {
      position: relative;
      padding: 10px;
      height: 20vh;
      text-align: center;
    }

    button {
      margin-top: 10px;
    }

    .website-group {
      position: absolute;
      top: 1px;
      left: 5px;
      width: 10vw;
      height: 10vh;
      margin: 3px;
      padding: 10px;
    }

    .health-bar-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .health-bar {
      width: 30vw;
      height: 30px;
      background-color: #ddd;
      position: absolute;
      top: 15vh;
      left: 0.5vw;
    }

    .current-health {
      height: 100%;
      background-color: #4CAF50;
      transition: width 0.5s;
    }

    .health-text {
      margin-top: 5vh;
    }

    .answer-text-input {
      width: 25vw;
      position: absolute;
      top: 23vh;
      left: 2.5vw;
    }

    .correct-answer {
      position: fixed;
      bottom: 0vh;
      left: 0vw;
      background-color: rgba(255, 255, 255, 0.3);
      border: rgba(255, 255, 255, 0.1);
      width: 40px;
    }

    .action_button {
      width: 10vw;
      height: 5vh;
      border-radius: 15px;
      margin: calc(5px);
    }

    #muteBtn {
      width: calc(20vw + 10px);
    }

    .Btn {
      background-color: var(--use-color-a2);
      color: white;
      text-shadow: none;
      text-align: center;
      border: solid 3px white;
      border-radius: 20px;
    }

    .Btn:hover {
      background-color: var(--use-color-c1);
    }

    .Selected {
      background-color: var(--use-color-c1);
    }
  </style>
</head>

<body class="default_text">

  <div class="grid-container">
    <div class="website-box">
      <button class="Btn website-group default_text small_text" onclick="">Group A</button>
      <div class="health-text large_text shadow" id="health-text-1">100</div>
      <div class="health-bar">
        <div class="current-health" id="health-bar-1"></div>
      </div>
      <input type="number" class="answer-text-input default_text small_text" id="answerInput1" placeholder="回答" min="0"
        step="1" max="100">
    </div>

    <div class="website-box">
      <button class="Btn website-group default_text small_text" onclick="">Group B</button>
      <div class="health-text large_text shadow" id="health-text-2">100</div>
      <div class="health-bar">
        <div class="current-health" id="health-bar-2"></div>
      </div>
      <input type="number" class="answer-text-input default_text small_text" id="answerInput2" placeholder="回答" min="0"
        step="1" max="100">
    </div>

    <div class="website-box">
      <button class="Btn website-group default_text small_text" onclick="">Group C</button>
      <div class="health-text large_text shadow" id="health-text-3">100</div>
      <div class="health-bar">
        <div class="current-health" id="health-bar-3"></div>
      </div>
      <input type="number" class="answer-text-input default_text small_text" id="answerInput3" placeholder="回答" min="0"
        step="1" max="100">
    </div>

    <div class="website-box">
      <button class="Btn website-group default_text small_text" onclick="">Group D</button>
      <div class="health-text large_text shadow" id="health-text-4">100</div>
      <div class="health-bar">
        <div class="current-health" id="health-bar-4"></div>
      </div>
      <input type="number" class="answer-text-input default_text small_text" id="answerInput4" placeholder="回答" min="0"
        step="1" max="100">
    </div>

    <div class="website-box">
      <button class="Btn website-group default_text small_text" onclick="">Group E</button>
      <div class="health-text large_text shadow" id="health-text-5">100</div>
      <div class="health-bar">
        <div class="current-health" id="health-bar-5"></div>
      </div>
      <input type="number" class="answer-text-input default_text small_text" id="answerInput5" placeholder="回答" min="0"
        step="1" max="100">
    </div>

    <div class="website-box">
      <button class="Btn website-group default_text small_text" onclick="">Group F</button>
      <div class="health-text large_text shadow" id="health-text-6">100</div>
      <div class="health-bar">
        <div class="current-health" id="health-bar-6"></div>
      </div>
      <input type="number" class="answer-text-input default_text small_text" id="answerInput6" placeholder="回答" min="0"
        step="1" max="100">
    </div>

  </div>

  <div class="website-box2">
    <button id="questionText" class="Btn action_button default_text small_text" onclick="nextQuestion()">例題</button>
    <button id="questionBtn" class="Btn action_button default_text small_text" onclick="showQuestion()">出題</button>
    <button id="answerBtn" class="Btn action_button default_text small_text"
      onclick="showAlert('','答えを表示してよろしいですか?','confirm','showAnswer()')">答え</button>
    <button id="reflectBtn" class="Btn action_button default_text small_text"
      onclick="showAlert('','結果を反映してよろしいですか?','confirm','decreaseHealth()')">反映</button>
    <br>
    <div class="large_text shadow" id="correctAnswer">正解：??%</div>
    <br>
    <button id="addBtn" class="Btn action_button default_text small_text" onclick="addHealth(50)">一律</button>
    <button id="resetBtn" class="Btn action_button default_text small_text"
      onclick="showAlert('','初期化してよろしいですか?','confirm','resetHealth()')">開始</button>
    <button class="Btn action_button default_text small_text" onclick="mute(this)" id="muteBtn">🔇ミュート中</button>
    <input type="password" class="correct-answer" id="correctAnswerInput" placeholder="正解" min="0" step="1"
      max="100"><br><br>
  </div>
  <!-- <br><br><br><br><br>
  <div class="website-box2">
  </div> -->


  <script>
    var muting = true;
    function mute(obj) {
      if (muting == true) {
        muting = false;
        obj.innerHTML = "🎵　通知中　"
      } else if (muting == false) {
        stopAllAlarms();
        muting = true;
        obj.innerHTML = "🔇ミュート中";
      }
    }

    let questionNumber = 0;
    let startHealth = 200;
    let QAdict = {
      "2022年の国内向け新車販売台数、<br>トヨタ車のシェアは何%?": 47,
      "日本の米の収穫量、<br>新潟県が占める割合、何%?": 8,
      "日本で落とした財布が<br>無事に戻ってくる確率、何%?": 63,
      "50代男性。<br>過去に職務質問をされたことがある人、何%?": 44,
      "働く女性に聞いた! <br>宝くじで1億円以上当たったら<br>今の仕事を辞める人、何%?": 68,
      "これまでに会社を<br>「ズル休み」したことがある人は何%?": 38,
      "自販機の下にお金が落ちている確率、何%?": 10,
      "飛行機内<br>「お客様の中にお医者様はいませんか!?」<br>⇒いる確率、何%?": 49,
      "共働き夫婦。<br>お互いの収入を知らない人は何%?": 12,

      "20~30代。<br>LINEで告白したことある人、何%?": 44,
      "おみくじを引いたら<br>なんと「大凶」!!この確率、何%?(鶴岡八幡宮)": 4,
      "18歳~26歳。<br>「充実させたいのは仕事よりプライベート!」、何%?": 68,
      "夫婦で同じベッドで寝ている人の割合、何%?": 28,
      "みそ汁の一番好きな具材は<br>『豆腐』、何%?": 11,
      "大学生。<br>アルバイトをしたことがない人は何%?(2022)": 4,
      "スマホをフィルムやケースで<br>保護している人、何%?": 88,
      "日本の18歳、生成AIを<br>使ったことがある人は何%?(2023/08)": 36,
      "10~30代。直近1ヵ月以内に<br>スマホゲームでお金を使った人、何%?": 28,
      "日本国内の<br>iPhoneシェア、何%?(2023/08)": 69,
      "小中学生。<br>親と同じ仕事をしたい人は何%?": 35,
      "日本の年次有給休暇取得率は何%?(2022)": 62,
    }

    function nextQuestion() {
      questionNumber++;
      updateQuestionText();
    }

    function updateQuestionText() {
      const questionTextElement = document.getElementById('questionText');
      questionTextElement.textContent = questionNumber + '問目';
    }

    function showQuestion() {
      if (muting == false) {
        const sound = playAlarm("img/question.mp3", false);
      }
      const questionTextElement = document.getElementById('questionText');
      showAlert2(questionTextElement.textContent, Object.keys(QAdict)[questionNumber]);
    }

    function showAnswer() {
      if (muting == false) {
        const sound = playAlarm("img/drumroll1.mp3", false);
      }
      animateNumber();
    }

    const numHealthBars = 6;
    let currentHealth = Array.from({ length: numHealthBars }, () => startHealth);
    updateHealthBars();

    function resetHealth() {
      currentHealth = Array.from({ length: numHealthBars }, () => startHealth);
      updateHealthBars();
      questionNumber = 1;
      updateQuestionText()
      for (let barNumber = 1; barNumber <= numHealthBars; barNumber++) {
        const inputAnswerInput = document.getElementById(`answerInput${barNumber}`);
        inputAnswerInput.value = "";
      }
    }
    function addHealth(value = 50) {
      for (let barNumber = 1; barNumber <= numHealthBars; barNumber++) {
        currentHealth[barNumber - 1] = currentHealth[barNumber - 1] + value;
      }
      updateHealthBars();
    }

    function decreaseHealth() {
      for (let barNumber = 1; barNumber <= numHealthBars; barNumber++) {
        const inputAnswerInput = document.getElementById(`answerInput${barNumber}`);
        const correctAnswer = document.getElementById('correctAnswerInput').value;
        if (inputAnswerInput.value == '') {
          continue;
        }
        const inputAnswer = parseInt(inputAnswerInput.value);
        if (inputAnswer == correctAnswer) {
          if (muting == false) {
            const sound = playAlarm("img/fanfare.mp3", false);
          }
        }
        const decreaseAmount = Math.abs(inputAnswer - correctAnswer);
        const newHealth = Math.max(0, currentHealth[barNumber - 1] - decreaseAmount);
        currentHealth[barNumber - 1] = newHealth;
        inputAnswerInput.value = "";
      }
      updateHealthBars();
    }

    function updateHealthBars() {
      for (let i = 1; i <= numHealthBars; i++) {
        const healthBar = document.getElementById(`health-bar-${i}`);
        const healthNumber = document.getElementById(`health-text-${i}`);
        healthBar.style.width = (currentHealth[i - 1] / (startHealth / 100)) + '%';
        healthNumber.textContent = currentHealth[i - 1];
        if (currentHealth[i - 1] <= 0) {
          healthNumber.style.color = "red";
        } else if (currentHealth[i - 1] <= 20) {
          healthNumber.style.color = "orange";
        } else {
          healthNumber.style.color = "black";
        }
      }
    }

    function set2fig(num) {
      if (num < 10) {
        return "0" + String(num);
      } else {
        return String(num);
      }
    }

    function animateNumber() {
      var inputNumber = document.getElementById('correctAnswerInput');
      if (Object.keys(QAdict).length >= questionNumber) {
        let firstQuestion = Object.keys(QAdict)[questionNumber];
        inputNumber.value = QAdict[firstQuestion];
      }
      const resultDisplay = document.getElementById('correctAnswer');
      const targetNumber = parseInt(inputNumber.value, 10) || 0;
      const animationDuration = 4000; // 4 seconds
      const animationInterval = 50; // Update every 50 milliseconds
      const steps = animationDuration / animationInterval;

      let currentNumber = 0;
      let stepCount = 0;

      const animationIntervalId = setInterval(() => {
        currentNumber = Math.floor(Math.random() * 100); // Random number between 0 and 99
        resultDisplay.textContent = "正解：" + set2fig(currentNumber) + "%";
        stepCount++;

        if (stepCount >= steps) {
          clearInterval(animationIntervalId);
          resultDisplay.textContent = "正解：" + set2fig(targetNumber) + "%";
          if (muting == false) {
            const sound = playAlarm("img/drumroll2.mp3", false);
          }
        }
      }, animationInterval);
    }

  </script>

</body>

</html>